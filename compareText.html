<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Table Creator</title>
<style>
    table {
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    th, td {
        border: 1px solid black;
        padding: 4px;
        max-width: 500px; /* Adjust this value as needed */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
		text-align: center;
    }
</style>
</head>
<body>
    <input type="file" id="file1" accept=".txt">
    <input type="file" id="file2" accept=".txt">
    <button onclick="createTables()">Create Tables</button>
    <div id="tableContainer"></div>
	<div hidden id="output1"></div>
	<div hidden id="output2"></div>
	<script src="diff.js"></script>
    <script>
        function createTables() {
            const file1 = document.getElementById('file1').files[0];
            const file2 = document.getElementById('file2').files[0];

            if (!file1 || !file2) {
                alert("Please select both files.");
                return;
            }

            const reader1 = new FileReader();
            reader1.onload = function() {
                let content1 = reader1.result;
                // Remove first line
                content1 = content1.substring(content1.indexOf('\n') + 1);
                // Remove leading and trailing whitespace
                content1 = content1.trim();
                // Remove newlines and spaces
                content1 = content1.replace(/[\n\r\s]+/g, '');

                const reader2 = new FileReader();
                reader2.onload = function() {
                    let content2 = reader2.result;
                    // Remove first line
                    content2 = content2.substring(content2.indexOf('\n') + 1);
                    // Remove leading and trailing whitespace
                    content2 = content2.trim();
                    // Remove newlines and spaces
                    content2 = content2.replace(/[\n\r\s]+/g, '');

                    const tableContainer = document.getElementById('tableContainer');
                    tableContainer.innerHTML = ''; // Clear previous tables if exist


					var diff1 = Diff["diffChars"](content1, content2);
					var diff2 = Diff["diffChars"](content2, content1);

					var output1 = document.getElementById("output1");
					output1.innerHTML = "";

					var output2 = document.getElementById("output2");
					output2.innerHTML = "";
					
					var o3 = "";
					var o4 = "";

					diff1.forEach(function(part) {
						var color = part.added ? 'green' :
									part.removed ? 'red' : 'black';
						if (!part.added) {
							for (const c of part.value) {
								var span = document.createElement('span');
								span.style.color = color;
								span.appendChild(document.createTextNode(c));
								output1.appendChild(span);
							}
						}
					});

					diff2.forEach(function(part) {
						var color = part.added ? 'green' :
									part.removed ? 'red' : 'black';
						if (!part.added) {
							for (const c of part.value) {
								var span = document.createElement('span');
								span.style.color = color;
								span.appendChild(document.createTextNode(c));
								output2.appendChild(span);
							}
						}
					});

					// Compare characters from output1 and output2 and modify outputs accordingly
					var span1 = output1.querySelectorAll('span');
					var span2 = output2.querySelectorAll('span');
					var counter1 = 0;
					var counter2 = 0;
					while (counter1 < span1.length && counter2 < span2.length) {
						var char1 = span1[counter1].textContent;
						var char2 = span2[counter2].textContent;
						if (char1 === char2) {
							// Characters are the same
							o3+=char1;
							o4+='.';
							counter1++;
							counter2++;

						} else if (span1[counter1].style.color === 'red' && span2[counter2].style.color === 'red') {
							// Both characters are red
							o3+=char1;
							o4+=char2;
							counter1++;
							counter2++;
						} else if (span1[counter1].style.color === 'red' && span2[counter2].style.color != 'red') {
							o3+=char1;
							o4+='-';
							counter1++;
						} else if (span1[counter1].style.color != 'red' && span2[counter2].style.color === 'red') {
							o3+='-';
							o4+=char2;
							counter2++;
						}
						else {
							counter1++;
							counter2++;
						}
					}



                    // Create tables for each 50 characters
					var c1 = 0;
					var c2 = 0;
                    for (let i = 0; i < Math.max(content1.length, content2.length); i += 50) {
                        const table = document.createElement('table');
                        const tr1 = document.createElement('tr');
                        const tr2 = document.createElement('tr');
                        const tr3 = document.createElement('tr');

                        // Populate rows
						const f1 = document.createElement('td');
                        const f2 = document.createElement('td');
                        const f3 = document.createElement('td');
						f2.textContent = file1.name;
						f3.textContent = file2.name;
						tr1.appendChild(f1);
                        tr2.appendChild(f2);
                        tr3.appendChild(f3);
						
                        for (let j = i; j < i + 50; j++) {
							if (j > o3.length || j > o4.length) { break; }
                            const td1 = document.createElement('td');
                            const td2 = document.createElement('td');
                            const td3 = document.createElement('td');

                            td1.textContent = j + 1;
                            td2.textContent = o3[j];
							if (o3[j] != '-') {
								c1++;
							} 
							if (c1 === 50) {
								td2.style.textDecoration = "underline";
								c1 = 0;
							}
							
							
                            td3.textContent = o4[j];
							if (o4[j] != '-') {
								c2++;
							} 
							if (c2 === 50) {
								td3.style.textDecoration = "underline";
								c2 = 0;
							}
							
                            tr1.appendChild(td1);
                            tr2.appendChild(td2);
                            tr3.appendChild(td3);
                        }

                        // Append rows to table
                        table.appendChild(tr1);
                        table.appendChild(tr2);
                        table.appendChild(tr3);

                        // Append table to container
                        tableContainer.appendChild(table);
                    }
                };

                reader2.readAsText(file2);
            };

            reader1.readAsText(file1);
        }
    </script>
</body>
</html>
