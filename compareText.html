<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text File Comparator</title>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    .container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .file-container {
        width: 45%;
        padding: 10px;
        border: 1px solid #ccc;
        overflow-y: auto;
        word-wrap: break-word;
    }
    .added {
        background-color: #ccffcc; /* light green */
    }
    .removed {
        background-color: #ffe6e6; /* light red */
    }
    .replaced {
        background-color: #ffff99; /* light yellow */
    }
    .highlighted {
        background-color: #ffccff; /* light purple */
    }
</style>
<script src="diff.js"></script>
</head>
<body>
    <h1>Text File Comparator</h1>
    <div class="container">
        <div class="file-container" id="file1-container">
            <h2>Reference File</h2>
        </div>
    </div>
    <input type="file" id="reference-file" accept=".txt">
    <br>
    <div class="container">
        <div class="file-container" id="file2-container">
            <h2>Files to Compare</h2>
        </div>
    </div>
    <input type="file" id="compare-files" accept=".txt" multiple>
    <br>
    <button onclick="selectReferenceFile()">Select Reference File</button>
    <button onclick="compareFiles()">Compare</button>

    <script>
        let referenceText = '';

        function readFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const fileContent = event.target.result;
                // Remove the first line
                const lines = fileContent.split('\n').slice(1).join('\n');
                // Remove spaces and newlines
                const cleanedContent = lines.replace(/\s+/g, '');
                callback(cleanedContent);
            };
            reader.readAsText(file);
        }

        function selectReferenceFile() {
            const referenceFile = document.getElementById('reference-file').files[0];
            if (!referenceFile) {
                alert('Please select a reference file.');
                return;
            }
            readFile(referenceFile, function(content) {
                referenceText = content;
                document.getElementById('file1-container').innerText = content;
            });
        }

        function compareFiles() {
            const files = document.getElementById('compare-files').files;
            if (!referenceText) {
                alert('Please select a reference file.');
                return;
            }
            const fileContainer = document.getElementById('file2-container');
            fileContainer.innerHTML = '';

            let prevStatus = ''; // Tracks previous status

            for (let i = 0; i < files.length; i++) {
                const currentFile = files[i];
                const fileDiv = document.createElement('div');
                fileDiv.classList.add('file-container');
                fileContainer.appendChild(fileDiv);

                const header = document.createElement('h2');
                header.textContent = `File ${i + 1}`;
                fileDiv.appendChild(header);

                readFile(currentFile, function(currentContent) {
                    const diff = Diff["diffChars"](referenceText, currentContent);

                    diff.forEach(function(part) {
                        const span = document.createElement('span');
                        span.textContent = part.value;

                        // Apply highlight color based on the previous part's status
                        if (prevStatus === 'added' && part.removed) {
                            span.classList.add('highlighted'); // Light purple
                        } else if (prevStatus === 'removed' && part.added) {
                            span.classList.add('highlighted'); // Light purple
                        } else if (part.added) {
                            span.classList.add('added'); // Light green
                            prevStatus = 'added';
                        } else if (part.removed) {
                            span.classList.add('removed'); // Light red
                            prevStatus = 'removed';
                        } else {
                            prevStatus = ''; // Reset previous status
                        }
                        fileDiv.appendChild(span);
                    });
                });
            }
        }
    </script>
</body>
</html>
