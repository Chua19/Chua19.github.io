<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text File Comparator</title>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    .container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .file-container {
        width: 45%;
        padding: 10px;
        border: 1px solid #ccc;
        overflow-y: auto;
        word-wrap: break-word;
    }
    .added {
        background-color: #ccffcc; /* light green */
    }
    .removed {
        background-color: #ffe6e6; /* light red */
    }
    .replaced {
        background-color: #ffff99; /* light yellow */
    }
    .highlighted {
        background-color: #ffccff; /* light purple */
    }
    .green-block-count {
        font-weight: bold;
    }
</style>
<script src="diff.js"></script>
</head>
<body>
    <h1>Text File Comparator</h1>
    <div class="container">
        <div class="file-container" id="file1-container">
            <h2>Reference File</h2>
        </div>
    </div>
    <input type="file" id="reference-file" accept=".txt">
    <br>
    <div class="container">
        <div class="file-container" id="file2-container">
            <h2>Files to Compare</h2>
        </div>
    </div>
    <input type="file" id="compare-file" accept=".txt">
    <button onclick="addCompareFile()">Add Compare File</button>
    <br>
    <button onclick="selectReferenceAndCompare()">Select Reference File and Compare</button>

    <script>
        let referenceText = '';
        let greenBlockCounts = []; // Array to store green block counts for each file

        function readFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const fileContent = event.target.result;
                // Remove the first line
                const lines = fileContent.split('\n').slice(1).join('\n');
                // Remove spaces and newlines
                const cleanedContent = lines.replace(/\s+/g, '');
                callback(cleanedContent);
            };
            reader.readAsText(file);
        }

        function selectReferenceAndCompare() {
            const referenceFile = document.getElementById('reference-file').files[0];
            if (!referenceFile) {
                alert('Please select a reference file.');
                return;
            }
            readFile(referenceFile, function(content) {
                referenceText = content;
                document.getElementById('file1-container').innerText = content;
                compareFiles();
            });
        }

        function addCompareFile() {
            const compareFile = document.getElementById('compare-file').files[0];
            if (!compareFile) {
                alert('Please select a compare file.');
                return;
            }
            const fileContainer = document.getElementById('file2-container');
            const fileDiv = document.createElement('div');
            fileDiv.classList.add('file-container');
            fileContainer.appendChild(fileDiv);

            const header = document.createElement('h2');
            header.textContent = `File ${fileContainer.children.length}`;
            fileDiv.appendChild(header);

            let greenBlockCount = 0; // Green block count for current file

            readFile(compareFile, function(currentContent) {
                const diff = Diff["diffChars"](referenceText, currentContent);

                let block = [];
                let prevStatus = '';
                diff.forEach(function(part) {
                    const span = document.createElement('span');
                    span.textContent = part.value;

                    if (part.added) {
                        if (prevStatus !== 'added') {
                            handleBlock(block, fileDiv);
                            block = [];
                        }
                        span.classList.add('added');
                        prevStatus = 'added';
                    } else if (part.removed) {
                        if (prevStatus !== 'removed') {
                            handleBlock(block, fileDiv);
                            block = [];
                        }
                        span.classList.add('removed');
                        prevStatus = 'removed';
                    } else {
                        if (prevStatus !== '') {
                            handleBlock(block, fileDiv);
                            block = [];
                        }
                        prevStatus = '';
                    }
                    block.push(span);
                });
                handleBlock(block, fileDiv);

                greenBlockCount = countGreenBlocks(fileDiv);
                greenBlockCounts.push(greenBlockCount);
                displayGreenBlockCount(fileDiv, greenBlockCount);
            });
        }

        function handleBlock(block, fileDiv) {
            if (block.length > 0) {
                let blockDiv = document.createElement('div');
                blockDiv.classList.add('block');
                block.forEach(span => blockDiv.appendChild(span));
                fileDiv.appendChild(blockDiv);
            }
        }

        function countGreenBlocks(fileDiv) {
            const greenBlocks = fileDiv.querySelectorAll('.added');
            return greenBlocks.length;
        }

        function displayGreenBlockCount(fileDiv, greenBlockCount) {
            const greenBlockCountElement = document.createElement('div');
            greenBlockCountElement.classList.add('green-block-count');
            greenBlockCountElement.innerText = `Number of Green Blocks: ${greenBlockCount}`;
            fileDiv.appendChild(greenBlockCountElement);
        }
    </script>
</body>
</html>
